# Запуск push-кампании

Перед созданием push-кампании убедитесь, что вы настроили push-уведомления и подключили библиотеку AppMetrica Push SDK. Подробнее в разделе [Push-уведомления](index.md).

Чтобы создать push-кампанию в AppMetrica, перейдите в раздел **Push-кампании**. Затем нажмите кнопку **Создать push** в левом верхнем углу страницы. Далее следуйте инструкции, описанной ниже.

## Шаг 1. Подберите аудиторию {#audience}

1. Введите имя кампании и выберите в выпадающем списке приложение, для которого она будет проводиться.
2. Подключите опцию Silent Push для отправки [silent push-уведомлений](*silent-push).
3. С помощью [стандартных сегментов сервиса](../mobile-reports/segmentation.md) выделите аудиторию, на которую вы планируете рассылать уведомление. Под меню сегментации вы увидите, количество пользователей, которые получат уведомление, разбивки по платформам и языку
   Количество пользователей, указанное в настройках push-кампании, может отличаться от количества всех активных пользователей в выбранном сегменте

   {% cut "Почему различаются показатели" %}

   Для отправки push-уведомлений AppMetrica использует push-токен устройства. AppMetrica Push SDK ([Android](../sdk/android/push/quick-start.md) | [iOS](../sdk/ios/push/quick-start.md)) отправляет push-токен на сервер при запуске приложения.

   Таким образом, в сегмент попадают пользователи, у которых установлена версия приложения с интегрированной библиотекой AppMetrica Push SDK, и которые запустили это приложение хотя бы один раз. Кроме того, пользователь может запретить приложению показывать push-уведомления. Такой пользователь также не попадет в аудиторию push-кампании.

   {% endcut %}

4. Нажмите кнопку **Конструктор** для перехода к следующему шагу.

## Шаг 2. Создайте push-уведомление {#notification}

Push-уведомление создается в **Конструкторе**. Чтобы создать уведомление для платформы, установите переключатель в положение **Вкл** напротив ее названия.

{% note warning "" %}

При создании уведомления обратите внимание на действующие [ограничения](#restrictions).

{% endnote %}

Для заполнения доступны поля, общие для всех платформ:

- **Заголовок** — заголовок push-уведомления. Поддерживает символы [Emoji](https://ru.wikipedia.org/wiki/Эмодзи).
- **Текст push-уведомления** — текст уведомления, может быть задан на нескольких языках. Набор языков формируется, основываясь на данных о языке, установленном на устройстве пользователей приложения. Текст уведомления поддерживает символы [Emoji](https://ru.wikipedia.org/wiki/Эмодзи).
- **Язык по умолчанию** — язык, на котором отображается текст уведомления, если для языка, установленного на устройстве, текст не задан. Например, push-уведомление отправляется на устройство с турецким языком, но поле **Текст push-уведомления** на турецком не заполнено. В этом случае вы можете выбрать английский язык по умолчанию, и пользователь такого устройства получит уведомление на английском языке.
- **Действие, при открытии уведомления** — действие, которое произойдет при открытии уведомления. Доступно несколько вариантов:
   - **Открыть приложение** (по умолчанию).
   - **URL** — содержимое указанного URL откроется в браузере.
   - **Deeplink** — откроется [deeplink](*deeplink*), ведущий на определенный экран приложения. Вы можете использовать deeplink, заданный ранее в настройках приложения или создать новый с помощью кнопки **Новая ссылка**.
- Протестировать на устройстве — позволяет выполнить отправку настроенного push-сообщения на указанное тестовое устройство. Выберите тестовое устройство из списка или создайте новое и нажмите кнопку **Протестировать**.
Также доступны дополнительные поля, различные для платформ:

{% cut "Android" %}

- **ID ресурса иконки** — название ресурса иконки вашего приложения в стандартном каталоге `/res/drawable/`. Иконка отобразится в строке уведомлений. Если вы не заполните поле, отобразится стандартная иконка приложения.
- Фон иконки — цвет иконки сообщения. Задается в виде строки в формате [шестнадцатеричного кода](https://ru.wikipedia.org/wiki/Цвета_HTML) `#AARRGGBB`. По умолчанию фон иконки прозрачный.
- Изображение рядом с уведомлением — изображение рядом с текстом уведомления. Укажите в этом поле ссылку на изображение, которое хотите разместить (например, `http://example.com/images/pic1.png`).
- Большая картинка-баннер — полноразмерное изображение, во всю ширину уведомления. Раскрывается по вертикали, если потянуть за уведомление сверху-вниз. Укажите в этом поле ссылку на изображение, которое хотите разместить (например, `http://example.com/images/pic1.png`).
- Звук сообщения — звук, воспроизводимый при доставке сообщения на устройстве пользователя. Доступные значения:
   - **По умолчанию** — звук будет воспроизведен в соответствии с режимом, установленным на устройстве.
   - **Без звука** — уведомление придет на устройство без звукового сигнала.
- **Вибрация** — включает или отключает вибрацию при получении уведомления.
- **LED-идентификатор** — цвет светового индикатора уведомления. Задается в виде строки в формате [шестнадцатеричного кода](https://ru.wikipedia.org/wiki/Цвета_HTML) `#RRGGBB`.
- **Приоритет пуша** — приоритет уведомления. Платформа определяет сообщения с высоким приоритетом и принимает соответствующие действия: прерывает работу пользователя (отображает сообщение на экране), не уведомляет пользователя о уведомлении. На разных устройствах приоритет интерпретируется по-разному.
- **Окно доставки** — время, в течение которого будут предприниматься попытки доставить сообщение на устройство пользователя. Если по истечении указанного времени устройство будет недоступно (например, не подключено к интернету), сообщение не будет доставлено. По умолчанию время не ограничено.
- **Канал** — канал push-уведомления. Если канал не задан — используется канал по умолчанию. Доступно только для Android 8 и выше. Подробнее о каналах в [документации Android](https://developer.android.com/training/notify-user/channels).

{% endcut %}

{% cut "iOS" %}

- **Badge** — число, которое отобразится на иконке приложения на рабочем столе, при получении уведомления.
- **Окно доставки** — время, в течение которого будут предприниматься попытки доставить сообщение на устройство пользователя. Если по истечении указанного времени устройство будет недоступно (например, не подключено к интернету), сообщение не будет доставлено. По умолчанию время не ограничено.
- **Звук сообщения** — звук, воспроизводимый при доставке сообщения на устройстве пользователя. Доступные значения:
   - **По умолчанию** — звук будет воспроизведен в соответствии с режимом, установленным на устройстве.
   - **Без звука** — уведомление придет на устройство без звукового сигнала.
- **Отслеживать доставку** — включает/отключает отслеживание доставки push-уведомлений. По умолчанию включено. Если отслеживание выключить, то в отчетах число доставленных push-сообщений будет равно числу открытых.

   {% note warning %}

   Для отслеживания доставок необходимо настроить сбор статистики push-уведомлений.

   {% endnote %}

{% endcut %}

В поле **Дополнительные данные** можно передавать приложению любые данные в виде строкового значения. Обработать строку данных можно с помощью соответствующих методов AppMetrica Push SDK ([Android](../sdk/android/push/quick-start.md) | [iOS](../sdk/ios/push/quick-start.md)).

### Ограничения {#restrictions}

Для push-уведомлений действуют следующие ограничения:

- Для Android и iOS: содержание всего push-сообщения не должно превышать 3968 байт.
- Для Windows: размер заголовка не больше 256 байт, размер текста не больше 512 байт.

{% note info "" %}

В зависимости от кодировки 1 символ может занимать от 1 до 4 байт.

{% endnote %}

### AB-тестирование {#ab-testing}

AppMetrica позволяет проводить **AB-тестирование** при запуске push-кампании. Такое тестирование помогает оценить эффективность разных вариантов уведомления в рамках одной кампании и определить, какое уведомление дает наилучшую конверсию. Вы можете создать до четырех гипотез.

В качестве одной из гипотез может быть *контрольная выборка* (для нее push-уведомление не отправится). С помощью контрольной выборки сравнивается поведение пользователей, не получивших уведомление, с остальными пользователями.

Статистика по проведению тестирования доступна в отчете по push-кампаниям.

## Шаг 3. Протестируйте push-уведомление {#test}

Тестирование доступно для устройств на Android и iOS.

Перед запуском push-кампании необходимо проверить, как отображается уведомление на вашем тестовом устройстве. Чтобы провести тестирование, выполните следующее:

1. Выберите доступное тестовое устройство из выпадающего списка. Если список пуст, добавьте устройство.

   {% cut "Добавление нового устройства" %}

   1. Нажмите кнопку Новое устройство.
   2. Укажите идентификатор устройства: доступны Google AID, Apple IDFA, IDFV, Huawei OAID, AppMetrica Device ID.

      {% cut "Как получить Google AID" %}

        На устройстве откройте приложение «Настройки Google» и перейдите в пункт меню **Реклама**. На экране указан Google AID (**Ваш рекламный идентификатор**).

      {% endcut %}

      {% cut "Как получить Apple IDFA" %}

        1. Установите на устройство приложение [The Identifiers](https://itunes.apple.com/us/app/the-identifiers/id564618183).
        2. В приложении откройте вкладку **Raw**. В поле **Advertising Identifier** указан IDFA вашего устройства.

       {% note alert %}

       Начиная с iOS 14.5 у приложений нет доступа к Apple IDFA. Рекомендуем использовать AppMetrica Device ID.

       {% endnote %}

      {% endcut %}

      {% cut "Как получить IDFV" %}

        1. Установите ваше приложение на тестовое устройство.
        2. Перейдите в **Экспорт данных** → **В файл** и экспортируйте установки с параметром `ios_ifv`. При экспорте используйте фильтры (например, фильтр по **app_version_name**).
        3. Скопируйте идентификатор в поле **ios_ifv**.

      {% endcut %}

      {% cut "Как получить Huawei OAID" %}

        1. На телефонах с EMUI перейдите в **Настройки** → **Конфиденциальность**  → **Реклама и конфиденциальность** → **Дополнительная информация**.
        2. Под заголовком **Ваш Ad-ID** отображается идентификатор. Скопируйте его.

      {% endcut %}

      {% cut "Как получить AppMetrica Device ID" %}

        1. Установите ваше приложение на тестовое устройство.
        2. В {% if locale == 'ru' %}[веб-интерфейсе AppMetrica](http://appmetrika.yandex.ru/){% endif %}{% if locale == 'en' %}[веб-интерфейсе AppMetrica](http://appmetrika.yandex.com/){% endif %} перейдите в **Отчеты** → **Список профилей**.
        3. Найдите свой профиль. При поиске используйте сегментацию (например, по номеру сборки или атрибутам устройства).
        4. Откройте карточку профиля и скопируйте идентификатор `appmetrica_device_id`.

       {% note alert %}

       Через мобильное приложение AppMetrica получить AppMetrica Device ID уже нельзя. Используйте вместо него {% if locale == 'ru' %}[веб-интерфейс AppMetrica](http://appmetrika.yandex.ru/){% endif %}{% if locale == 'en' %}[веб-интерфейс AppMetrica](http://appmetrika.yandex.com/){% endif %}.

       {% endnote %}

      {% endcut %}

   3. Нажмите кнопку **Добавить**. Устройство доступно в выпадающем списке.

   {% endcut %}

2. Нажмите кнопку **Протестировать**. После этого уведомление будет отправлено на тестовое устройство.

{% note info "Для устройств на iOS" %}

Push-уведомление в debug-версии может не прийти: сертификат из раздела **Production** для нее не работает. Тестировать уведомления лучше на релизной сборке.

{% endnote %}

Если тестирование прошло успешно, нажмите кнопку **Страница отправки** для перехода к следующему шагу.

## Шаг 4. Проверьте информацию и отправьте push-уведомление {#send}

На странице отправки push-уведомления доступна общая информация об отправляемом сообщении. Убедитесь, что вся информация указана верно.

Чтобы отправить push-уведомление выполните следующее:

1. Установите время отправки push-уведомления в разделе **Расписание отправки**.
   Чтобы запланировать отправку на произвольное время, перейдите на вкладку **Позже** и выберите необходимые дату и время. Включите опцию **Учитывать часовой пояс на устройстве**, чтобы отправить уведомление с учетом часового пояса устройства.

2. Нажмите кнопку **Отправить push пользователям**.

{{ feedback }}

<a href="../troubleshooting/feedback-new.html">
  <span class="button">Написать в службу поддержки</span>
</a>

{% include notitle [feedback](../_includes/feedback-button.md) %}

[*silent-push]: {{ silent-push }}

[*deeplink]: {{ deeplink }}
