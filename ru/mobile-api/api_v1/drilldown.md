# Drill down

Позволяет сформировать многоуровненвый (древовидный) отчет. При этом каждому уровню соответствует одна группировка.

Запрос к методу `drilldown` возвращает один подуровень для указанного родительского уровня. Родительский уровень указывается в параметре `parent_id`. Чтобы получить данные для первого уровня, отправьте запрос без параметра `parent_id`.

Чтобы получить данные для вложенных уровней, необходимо указать путь от корня. Путь формируется из значений поля `id` параметра `dimension`. Если поле id отсутствует, укажите поле `name`.

## Формат запроса {#request}

```
GET {{ api-url }}/stat/v1/data/drilldown
  ? ids=<int,int,...>
  & metrics=<string>
  & [accuracy=<string>]
  & [callback=<string>]
  & [date1=<string>]
  & [date2=<string>]
  & [dimensions=<string>]
  & [filters=<string>]
  & [group=<group_type>]
  & [id=<integer>]
  & [include_undefined=<boolean>]
  & [lang=<string>]
  & [limit=<integer>]
  & [offset=<integer>]
  & [parent_id=<string>]
  & [pretty=<boolean>]
  & [sort=<string>]
```

#|
|| `ids`* | Идентификаторы счетчиков, через запятую. Используется вместо параметра `id`. ||
|| `metrics`* | Список метрик, разделенных запятой.

Лимит: 20 метрик в запросе. ||
|| `accuracy` | Точность вычисления результата. Позволяет управлять семплированием (количеством визитов, использованных при расчете итогового значения).
Значение по умолчанию: `medium`. ||
|| `callback` | Функция обратного вызова, которая обрабатывает ответ API.||
|| `date1` | Дата начала периода выборки в формате YYYY-MM-DD. Также используйте значения: `today`, `yesterday`, `ndaysAgo`.

Значение по умолчанию: `6daysAgo`. ||
|| `date2` | Дата окончания периода выборки в формате YYYY-MM-DD. Также используйте значения: `today`, `yesterday`, `ndaysAgo`.

Значение по умолчанию: `today`. ||
|| `dimensions` | Список группировок, разделенных запятой.

Лимит: 10 группировок в запросе. ||
|| `filters` | [Фильтр сегментации](segmentation.md).

Лимит: количество уникальных группировок и метрик — до 10, количество отдельных фильтров — до 20, длина строки в фильтре — до 10000 символов. ||
|| `group` | Группировка данных по времени.
Значение по умолчанию: `week`.

Допустимые значения:

- `all` — временной интервал не разбивается.
- `hours` — временной интервал разбивается на интервалы из нескольких часов.
- `auto` — автоматический режим.
- `week` — временной интервал разбивается по неделям.
- `month` — временной интервал разбивается по месяцам.
- `hour` — временной интервал разбивается на часовые интервалы.
- `year` — временной интервал разбивается по годам.
- `minutes` — временной интервал разбивается на интервалы из некоторого количества минут.
- `day` — временной интервал разбивается по дням.
- `dekaminute` — временной интервал разбивается на 10-минутные интервалы.
- `quarter` — временной интервал разбивается по кварталам.
- `minute` — временной интервал разбивается на минутные интервалы. ||
|| `id` | Идентификатор счетчика. Устарело, используйте `ids`. ||
|| `include_undefined `| Включает в ответ строки, для которых значения группировок не определены. Влияет только на первую группировку. По умолчанию выключено. ||
|| `lang` | Язык. ||
|| `limit` | Количество элементов на странице выдачи.

Лимит: 10000.

Значение по умолчанию: 100. ||
|| `offset` | Индекс первой строки выборки, начиная с 1.
Значение по умолчанию: 1. ||
|| `parent_id` | Выбор строки для дальнейшего развертывания. Состоит из json-списка ключей. ||
|| `pretty` | Задает форматирование результата. Чтобы использовать форматирование, укажите значение `true`.
Значение по умолчанию: `false`. ||
|| `sort` | Список группировок и метрик, разделенных запятой, по которым осуществляется сортировка. По умолчанию сортировка производится по возрастанию.Чтобы отсортировать данные по убыванию, укажите знак <q>-</q> перед группировкой или метрикой. ||
|#

## Формат ответа {#response}

```json translate=no
{
    "total_rows" :  < long > ,
    "sampled" :  < boolean > ,
    "sample_share" :  < double > ,
    "sample_size" :  < long > ,
    "sample_space" :  < long > ,
    "data_lag" :  < int > ,
    "query" : {
        "ids" : [  < int > , ... ],
        "dimensions" : [  < string > , ... ],
        "metrics" : [  < string > , ... ],
        "sort" : [  < string > , ... ],
        "date1" :  < string > ,
        "date2" :  < string >,
        "filters" :  < string > ,
        "limit" :  < integer > ,
        "offset" :  < integer > 
    },
    "totals" : [  < double > , ... ],
    "min" : [  < double > , ... ],
    "max" : [  < double > , ... ],
    "data" : [ {
        "dimension" : {
            "key_1" :  < string > ,
            "key_2" : ...
        },
        "metrics" : [  < double > , ... ],
        "expand" :  < boolean > 
    }, ... ]
}
```

| Параметры | Описание |
| ----- | ----- |
| `total_rows` | Общее количество строк в ответе. |
| `sampled` | Признак семплирования. Показывает, был ли применен семплинг. Возможные значения: `true`, `false`. |
| `sample_share` | Доля данных, по которым осуществлялся расчет. Доступно значение в пределах от 0 до 1. |
| `sample_size` | Количество строк в выборке данных. |
| `sample_space` | Количество строк данных. |
| `data_lag` | Задержка в обновлении данных, в секундах. |
| `query` | Исходный запрос. Содержит параметры запроса, включая развернутые параметры из шаблона и параметры для схемы параметризации атрибутов. |
| `totals` | Общие результаты для метрик по всему множеству данных (с учетом фильтра). |
| `min` | Минимальные результаты для метрик среди попавших в выдачу ключей. |
| `max` | Максимальные результаты для метрик среди попавших в выдачу ключей. |
| `data` | Строки ответа. Представляет собой массив, каждый элемент которого — одна строка результата. |
| `query.ids` | Идентификаторы счетчиков. |
| `query.dimensions` | Массив группировок. |
| `query.metrics` | Массив метрик. |
| `query.sort` | Массив сортировок. |
| `query.date1` | Дата начала периода выборки в формате YYYY-MM-DD. |
| `query.date2` | Дата окончания периода выборки в формате YYYY-MM-DD. |
| `query.filters` | Фильтр сегментации. |
| `query.limit` | Количество элементов на странице выдачи. |
| `query.offset` | Индекс первой строки выборки, начиная с 1. |
| `data.dimension` | Значение группировки для заданного уровня дерева. Например, задан второй уровень дерева (длина переданного массива `parent_id` равна единице). В данном случае поле будет содержать значение второй группировки запроса. |
| `data.metrics` | Массив значений метрик для данной строки. Значения этого массива — числа или `null`. |
| `edata.xpand` | Указывает можно ли раскрыть эту строку на следующий уровень дерева. |

## Пример запроса {#example}

{% list tabs %}
 
- cURL

  ```bash translate=no
  curl -X GET \
    '{{ api-url }}/stat/v1/data/drilldown?ids=1111&metrics=ym:ge:users' \
    -H 'Authorization: OAuth <your_token>'
  ```

  где `<your_token>` — это OAuth-токен, который можно получить по [инструкции](../intro/authorization.md#get-oauth-token).

- HTTP

  ```http translate=no
  GET /stat/v1/data/drilldown?ids=1111&metrics=ym%3Age%3Ausers HTTP/1.1
  Host: api.appmetrica.yandex.ru
  Authorization: OAuth <your_token>
  ```

  где `<your_token>` — это OAuth-токен, который можно получить по [инструкции](../intro/authorization.md#get-oauth-token).

{% endlist %}

{{ feedback }}

<a href="../../troubleshooting/feedback-new.html">
  <span class="button">Написать в службу поддержки</span>
</a>

{% include notitle [feedback](../../_includes/feedback-button.md) %}
