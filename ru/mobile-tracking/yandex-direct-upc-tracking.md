# Трекинг Единой перфоманс-кампании (ЕПК) 

[Единая перфоманс-кампания](https://yandex.ru/support/direct/{{ locale }}/products-mobile-apps-ads/upc/about) (ЕПК) — инструмент для создания рекламной кампании, которая расширяет возможности привычных кампаний Директа и позволяет лучше настроить продвижение Рекламы мобильных приложений.

AppMetrica помогает передавать данные о новых установках и действиях пользователей в приложениях в Яндекс Директ. Это позволяет эффективно отслеживать конверсии и оптимизировать рекламные кампании.

Чтобы AppMetrica могла фиксировать конверсии и сообщать о них в Яндекс Директ, выполните действия:

- [Создайте трекер](#create-tracker) и получите [трекинговую ссылку](*трекинг-ссылка) для использования в рекламных кампаниях в Яндекс Директ.

- [Добавьте постбеки](#postback) для передачи данных о событиях.

{% note info "" %}

Трекер фиксирует источник установки приложения. Постбеки передают информацию об установках и событиях в рекламную систему.

{% endnote %}

## Создание трекера и получение трекинговой ссылки {#setup-tracker}

1. В интерфейсе AppMetrica перейдите в раздел **{{ tracking }}** → **{{ create-tracker}}**. 

    Укажите название трекера.
  
    Если запускаете ремаркетинговую кампанию, включите опцию **{{ this-is-a-remarketing-campaign }}**.

2. В выпадающем списке **{{ application }}** выберите приложение. SDК уже должен быть прописан в коде приложения. Подробнее о том, как добавить SDK для [Android](../sdk/android/analytics/quick-start.md) и [iOS](../sdk/ios/analytics/quick-start.md).

3. В выпадающем списке **{{ media-source }}** выберите **Yandex.Direct**.

    Любой другой партнер не подойдет, нужно выбрать именно Yandex.Direct. Если вам необходимо выбрать другого партнера для оптимизации рекламной кампании в Яндекс Директ, напишите в [службу поддержки](../troubleshooting/feedback-new.md), приложив ID трекера.

4. В разделе **SmartLink** добавьте одну платформу, которую планируете рекламировать. Для каждой операционной системы требуется отдельная рекламная кампания, поэтому в трекере указывается только одна платформа.

    Если запускаете ремаркетинговую рекламную кампанию, обязательно укажите **Deeplink**, предварительно его протестировав.

    {% cut "Как тестировать deeplink" %}
    
    1. Откройте любой сервис, который генерирует «короткие ссылки», например, [TinyUrl](https://tinyurl.com/).

    1. Введите ваш deeplink в поле для исходной ссылки (long URL) и сгенерируйте «короткую ссылку» (short URL). 
    
    1. Скопируйте получившуюся «короткую ссылку» на свое мобильное устройство и перейдите по ссылке. 
    
    Если приложение установлено и при переходе по ссылке оно открывается — все работает корректно. Если приложение не открылось, обратитесь к своему разработчику с просьбой проверить, правильный ли вам выдан deeplink. 
    
    {% endcut %}
  
5. Раздел **{{ attribution-settings }}** мы рекомендуем не изменять и оставить значения по умолчанию. Подробнее про [Технологии трекинга](technology.md).

## Настройка постбеков {#postback}
   
Постбек на событие **{{ event-installation }}** добавляется автоматически. 

Чтобы передавать данные о других действиях пользователей в приложении, нажмите **{{ add-postback }}**. Затем выберите тип события и подходящий шаблон.

{% note info "" %}

В кампаниях Рекламы мобильных приложений есть типизированный набор событий, которым соответствует набор шаблонов в постбеках в AppMetrica.  Их названия полностью совпадают с [названиями целей внутри Яндекс Директа](https://yandex.ru/support/direct/{{ locale }}/strategies/average-cpa-mobile-apps#conditions).

{% endnote %}

Вы можете выбрать любое событие, релевантное для вашего приложения, например: событие **Purchased**, если передаете покупку; **Completed registration**, если фиксируете регистрацию пользователя. При этом событие в AppMetrica необязательно должно называться точно так же или соответствовать именно этому действию.

**Опции**

- **{{ send-postback-on-first-target-event-only }}**

    В рекламную сеть будет отправлено только первое целевое событие, остальные отправлены не будут. 
  
    Например, вы выбрали событие **Покупка** и отправляете его в шаблон **Purchased**. Пользователь 1 января выполнил установку, 2 января сделал первую покупку, а 3 января сделал вторую покупку. При включенной опции в Яндекс Директ будет отправлена только покупка от 2 января. В AppMetrica же вы увидите все покупки.

- **{{ send-postback-on-actions-of-all-users }}**

    При включенной опции рекламная сеть будет получать информацию о всех выбранных в постебке событиях вне зависимости от источника установки. 
  
    В таких типах постбеков вырезаются атрибутированные параметры, чтобы рекламная сеть не могла себе присвоить установки других источников. Если такая опция необходима, создайте два постбека: один с включенной опцией, другой — с выключенной. В остальных случаях опцию рекомендуется оставлять выключенной.
    
## Верификация приложения в Яндекс Директ {#verification}

Если рекламный кабинет и AppMetrica зарегистрированы на один логин, верификация происходит автоматически. Если они зарегистрированы на разные логины, в AppMetrica в разделе **{{ settings }}** → **{{ manage-access }}** выдайте доступ логину, с которого будут запускаться рекламные кампании.

## Частые вопросы {#faq}

{% cut "Могу ли я выбрать другого партнера, не Yandex.Direct, но использовать трекинговую ссылку в рекламной кампании Директа?" %}

Нет, для корректной передачи данных об установках и событиях необходимо выбрать именно партнера Yandex.Direct. Если строго необходимо выбрать другого партнера, нужно предварительно написать в [службу поддержки](../troubleshooting/feedback-new.md) для активации партнера.

{% endcut %}

{% cut "Почему количество установок в Яндекс Директ не совпадает с отчетами в AppMetrica?" %}

AppMetrica фиксирует установки по дате их происхождения, а Яндекс Директ привязывает их к дате клика. 

Например, если пользователь кликнул по рекламе 1 января, но установил приложение 2 января, AppMetrica зафиксирует установку 2 января, а Яндекс Директ — 1 января.

{% endcut %}

{% cut "Почему количество кликов и показов в Яндекс Директе и AppMetrica отличается?" %}

Есть несколько причин:

1. В Яндекс Директе, как рекламной сети, есть своя антифрод-система, которая умеет фильтровать подозрительные клики. AppMetrica фиксирует все клики по трекинг-ссылкам, кроме тех, в UserAgent-е которых был передан флаг `IsBot`.

2. В Яндексе есть свои роботы-обходчики, которые проверяют, например, что ссылки ведут не на фишинговые сайты. Если на момент проверки этим роботом будет наша трекинг-ссылка, а в самих показах/кликах не будет передан параметр `IsBot`, то AppMetrica зафиксирует такую статистику. Директ такие показы/клики не покажет.

{% endcut %}

## Узнайте больше {#learn-more}

- [Реклама мобильных приложений](https://yandex.ru/support/direct/{{ locale }}/products-mobile-apps-ads/about)

{{ feedback }}

<a href="../troubleshooting/feedback-new.html">
  <span class="button">Написать в службу поддержки</span>
</a>

{% include notitle [feedback](../_includes/feedback-button.md) %}

[*трекинг-ссылка]: Ссылка вида `https://redirect.appmetrica.yandex.com/serve/*`, при переходе по которой, пользователь попадает в магазин приложений для установки приложения или если приложение уже установлено, открывает его (если указан deeplink). Создается при заведении трекера. Подробнее о трекинге в разделе [Что такое трекинг](index.md).
