# Трекинг кампаний Apple Search Ads

AppMetrica отслеживает рекламные кампании Apple Search Ads. Apple самостоятельно атрибутирует установки из Search Ads.

{% note info %}

Для полной атрибуции Apple Search Ads на устройствах с iOS 14.5 и выше рекомендуем использовать AppMetrica SDK 3.15.1 и более поздние версии.

{% endnote %}

Для версий iOS 14.5 и выше запрашивается разрешение пользователя на доступ к рекламному идентификатору и трекингу. Для пользователей, не предоставивших доступ к IDFA, используется новая система атрибуции — AdServices Framework.

Для версии iOS 14.4 и ниже поддерживается прежний способ трекинга iAd Framework. Для этого подходит AppMetrica SDK 2.9.4 или выше.

Для iOS 14.5 и выше также можно использовать iAd Framework, но пользователи, не предоставившие доступ к IDFA, не атрибутируются.

**Сравнение систем атрибуции**

#|
||   | **iAd Framework** | **AdServices Framework** ||
|| Поддерживаемые версии iOS | 10 и выше | 14.3 и выше ||
|| Трекинг iOS 14.4 и ниже | Доступ к IDFA не требуется. iAd Framework будет работать по-прежнему. | Доступ к IDFA не требуется. AdServices Framework будет работать на устройствах с iOS версий 14.3-14.4. ||
|| Ограничения трекинга для iOS 14.5 и выше | Будет атрибутировать только пользователей, давших согласие на трекинг, — если в приложении доступен IDFA.

Не будет атрибутировать пользователей, которые не разрешили доступ к IDFA: `ATTrackingManager.AuthorizationStatus = denied` или `notDetermined` | Будет атрибутировать пользователей, которые не разрешили доступ к IDFA, с усеченной детализацией: без даты клика. ||
|| Как настроить |
 - AppMetrica SDK 2.9.4 или выше.
 - Добавить библиотеку iAd Framework в проект по [инструкции](#iad). | AppMetrica SDK 3.15.1 или выше. ||
|| Доступные параметры кампании | 

`iad-org-name` — String. Название организации, которая размещает кампанию.
    
`iad-org-id` — Integer. Идентификатор организации, которая размещает кампанию.
    
`iad-campaign-id` — Integer. Идентификатор кампании, в которую входит объявление.
    
`iad-campaign-name` — String. Название кампании, в которую входит соответствующее объявление.
    
`iad-click-date` — Date/time string. Дата и время клика на объявление.
    
`iad-purchase-date` — Date/time string. Дата и время, когда пользователь впервые загрузил ваше приложение. Когда `iad-conversion-type` принимает значение `redownload`, `iad-purchase-date` — дата исходной загрузки. Загрузка может быть не связана с рекламой в Apple Search Ads.
    
`iad-conversion-date` — Date/time string. Дата и время, когда пользователь загрузил ваше приложение по клику на объявление.
    
`iad-conversion-type` — String. Тип конверсии. Возможные значения: `new download` — первичная загрузка, `redownload` — загрузка приложения пользователями, которые ранее уже устанавливали ваше приложение.
    
`iad-adgroup-id` — Integer. Идентификатор группы объявлений.
    
`iad-adgroup-name` — String. Название группы объявлений.
    
`iad-country-or-region` — String. Страна или регион, связанные с кампанией, которая привела к установке.
    
`iad-keyword` — String. Ключевое слово, которое привело к показу объявления и клику.
    
`iad-keyword-id` — Integer. Идентификатор ключевого слова, которое привело к показу объявления.
    
`iad-keyword-matchtype` — String. Тип соответствия ключевого слова, которое привело к показу объявления.
    
`iad-creativeset-id` — Integer. Идентификатор набора креативов.
    
`iad-creativeset-name` — String. Название набора креативов. | 

Поддерживаются только идентификаторы сущностей.
    
`orgId` — Integer. Идентификатор организации, которая размещает кампанию.
    
`campaignId` — Integer. Идентификатор кампании, в которую входит объявление.
    
`conversionType` — String. Тип конверсии. Возможные значения: `new download` — первичная загрузка, `redownload` — загрузка пользователями, которые ранее уже устанавливали ваше приложение.
    
`clickDate` — Date/time string. Дата и время клика на объявление.
    
`adGroupId` — Integer. Идентификатор группы объявлений.
    
`countryOrRegion` — String. Страна или регион, связанные с кампанией, которая привела к установке.
    
`keywordId` — Integer. Идентификатор ключевого слова, которое привело к показу объявления и клику.
    
`creativeSetId` — Integer. Идентификатор набора креативов.
    
Наименования не поддерживаются. ||
|#

{% list tabs %}

- iAd Framework

  **Шаг 1. Интегрируйте iAd Framework**
  
  :   Интегрируйте iAd Framework в приложение с установленным AppMetrica SDK, чтобы платформа Apple Search Ads атрибутировала установки. Инструкция по интеграции доступна [на сайте Search Ads](https://developer.apple.com/documentation/iad/setting_up_apple_search_ads_attribution) (см. пункт **Add the iAd Framework to Your Xcode Project**).

      {% cut "Подключение в Unity" %}
      
      В интерфейсе Unity 3d откройте **Settings** → **Other Settings** → **Scripting Define** → **Symbols**. Добавьте директиву APP_METRICA_ADD_IAD_FRAMEWORK.
      
      {% note info %}
      
      Если вы добавили iAd Framework в Xcode-проекте, директиву добавлять не обязательно.
      
      {% endnote %}
      
      {% endcut %}
      
      После добавления iAd Framework, AppMetrica SDK автоматически начнет учитывать установки из Apple Search Ads.
  
  **Шаг 2. Проведите тестовую установку**

  :   Создайте тестовую рекламную кампанию для Search Ads и установите приложение через рекламное размещение. Трекер для этого источника появится в AppMetrica автоматически.
  
  **Шаг 3. (_Опционально_) Настройте атрибуцию**
  
  :   Настройте атрибуцию Search Ads, используя настройки трекера:

      1. Перейдите в раздел **Трекеры**. Для того чтобы отфильтровать трекеры по партнеру, нажмите на выпадающий список **Партнёры** в меню слева и выберите **Apple Search Ads**.
      2. Выберите из списка трекер, для которого требуется настроить атрибуцию. Имя трекера соответствует имени кампании в Apple Search Ads.
      3. Внесите необходимые изменения в раздел **Настройка атрибуции** и нажмите кнопку **Сохранить**. Подробнее о настройке [атрибуции](add-tracker.md#step4).
  
  **Шаг 4. (_Опционально_) Настройте постбеки**
  
  :   Описанные выше параметры кампании можно отправлять в постбеки, используя их в качестве макросов. Например, для передачи идентификатора кампании в параметре `campaign_id` в postback URL следует указать `campaign_id={iad-campaign-id}`. Также доступны все [системные макросы](postback-specification.md).

      Настройте постбеки, используя настройки трекера:
      
      1. Перейдите в раздел **Трекеры**. Для того чтобы отфильтровать трекеры по партнеру, нажмите на выпадающий список **Партнёры** в меню слева и выберите **Apple Search Ads**.
      2. Выберите из списка трекер, для которого требуется настроить постбек. Имя трекера соответствует имени кампании в Apple Search Ads.
      3. Внесите необходимые изменения в раздел **Настройка постбеков** и нажмите кнопку **Сохранить**. Подробнее о настройке [постбеков](add-tracker.md#step5).
  
- AdServices Framework

  Атрибутировать пользователей, которые не дали разрешение на доступ к рекламному идентификатору и трекингу, можно с помощью AdServices Framework. Чтобы перейти на эту систему трекинга, обновите AppMetrica SDK до версии 3.15.1, дальнейшей настройки не потребуется.
  
  В AppMetrica SDK версии 3.15.0 и ниже AdServices Framework не поддерживается, и атрибутировать пользователей без доступа к IDFA нельзя.
  
  **Шаг 1. Проведите тестовую установку**

  :   Создайте тестовую рекламную кампанию для Search Ads и установите приложение через рекламное размещение. Трекер для этого источника появится в AppMetrica автоматически:

      ![](https://yastatic.net/s3/doc-binary/src/dev/appmetrica/{{locale}}/images/mobile-tracking/searchads.png){style="border: solid 1px #cccccc; max-width: 800px;"}

  **Шаг 2. (_Опционально_) Настройте атрибуцию**
  
  :   Настройте атрибуцию Search Ads, используя настройки трекера:

      1. Перейдите в раздел **Трекеры**. Для того чтобы отфильтровать трекеры по партнеру, нажмите на выпадающий список **Партнёры** в меню слева и выберите **Apple Search Ads**.
      2. Выберите из списка трекер, для которого требуется настроить атрибуцию. Имя трекера соответствует имени кампании в Apple Search Ads.
      3. Внесите необходимые изменения в раздел **Настройка атрибуции** и нажмите кнопку **Сохранить**. Подробнее о настройке [атрибуции](add-tracker.md#step4).
  
  **Шаг 3. (_Опционально_) Настройте постбеки**

  :   Описанные выше параметры кампании можно отправлять в постбеки, используя их в качестве макросов. Например, для передачи идентификатора кампании в параметре `campaign_id` в postback URL следует указать `campaign_id={campaignId}`. Также доступны все [системные макросы](postback-specification.md).

      Настройте постбеки, используя настройки трекера:
      
      1. Перейдите в раздел **Трекеры**. Для того чтобы отфильтровать трекеры по партнеру, нажмите на выпадающий список **Партнёры** в меню слева и выберите **Apple Search Ads**.
      2. Выберите из списка трекер, для которого требуется настроить постбек. Имя трекера соответствует имени кампании в Apple Search Ads.
      3. Внесите необходимые изменения в раздел **Настройка постбеков** и нажмите кнопку **Сохранить**. Подробнее о настройке [постбеков](add-tracker.md#step5).

{% endlist %}

{{ feedback }}

<a href="../troubleshooting/feedback-new.html">
  <span class="button">Написать в службу поддержки</span>
</a>

{% include notitle [feedback](../_includes/feedback-button.md) %}
