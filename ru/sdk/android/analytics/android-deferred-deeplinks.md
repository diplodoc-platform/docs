# Поддержка отложенных deeplinks

Отложенный deeplink используется для передачи параметров в приложение при первом запуске. Эти параметры могут быть использованы для действий внутри приложения (переход на определенный экран, показ определенного контента и т. д.) в зависимости от источника, который привел пользователя.

В отличие от обычного deeplink, отложенный deeplink срабатывает только при первом запуске приложения.

{% note info "" %}

Отложенные deeplinks поддерживаются только на устройствах с системой Android.

{% endnote %}

## Принцип работы отложенных deeplinks {#process}

Общая схема работы отложенных deeplinks выглядит следующим образом:

![](https://yastatic.net/s3/doc-binary/src/dev/appmetrica/{{locale}}/images/mobile-sdk-dg/deferred-deeplink.png)

1. Пользователь нажимает на трекинговую ссылку, которая содержит параметры отложенного deeplink.
1. Tracking URL направляет пользователя в магазин приложений для установки.
1. Пользователь скачивает приложение.
1. После первого запуска приложения параметры отложенного deeplink будут отправлены в приложение. Для получения параметров необходимо [выполнить запрос](android-operations.md#deferreddeeplink-request).

## Как настроить отложенный deeplink {#setup}

1. Укажите ссылку в [трекере](../../../mobile-tracking/add-tracker.md) в поле **Deeplink** — ссылка будет работать и как обычный deeplink, и как отложенный.

2. Обработайте получение deeplink или параметров в приложении. Например, вызовите навигацию на нужный экран, выполнив [запрос](android-operations.md#deferreddeeplink-request).

    Если вы запрашиваете параметры отложенного deeplink, убедитесь, что эти параметры есть в deeplink.

{% note warning "" %}

Параметры из трекинг-ссылки в deeplink автоматически не передаются, но их можно передать по [инструкции](../../../mobile-tracking/tracking-specification.md#passing-params). Передать параметры таким образом можно и в обычный deeplink, и в отложенный.

{% endnote %}

## Описание возможных ошибок {#errors}

Интерфейсы `DeferredDeeplinkListener` и `DeferredDeeplinkParametersListener` содержат перечисления ошибок, которые могут возникнуть при запросе:

**NOT_A_FIRST_LAUNCH**

Параметры или отложенный deeplink не могут быть получены, так как метод запроса параметров был вызван не при первом запуске приложения.

Первый запуск приложения — это сессия работы процесса (среды исполнения, виртуальной машины), в течение которой пользователь впервые запрашивает параметры. Если deeplink присутствует на момент запроса, то синхронно в том же потоке выполнится вызов слушателя. При следующем запуске процесса библиотека уже не увидит отложенного deeplink и будет возвращена ошибка `NOT_A_FIRST_LAUNCH`.

**PARSE_ERROR**

В зависимости от интерфейса, ошибка означает следующее:

* если используется интерфейс `DeferredDeeplinkListener` — не удалось найти отложенный deeplink. Такое возможно в случае, если реферрер не содержал параметра `appmetrica_deep_link`;
* если используется интерфейс `DeferredDeeplinkParametersListener` — отложенный deeplink не содержит валидных параметров.
   Ошибка `PARSE_ERROR` будет возвращена, если не будет выполнено одно из следующих условий:

   * INSTALL_REFERRER должен содержать параметр `appmetrica_deep_link`.
   * Значение параметра `appmetrica_deep_link` должно содержать валидный URI.
   * В deeplink URI должен быть как минимум один query-параметр.
   
   Пример валидного deeplink: `sampleapp://samplepath?sampleparam1=samplevalue1`.

## Узнайте больше {#learn-more}

[Запрос параметров отложенного deeplink](android-operations.md#deferreddeeplink-parameters-request)

{{ feedback }}

<a href="../../../troubleshooting/feedback-new.html">
  <span class="button">Написать в службу поддержки</span>
</a>

{% include notitle [feedback](../../../_includes/feedback-button.md) %}
