# Поддержка Universal Links


Для версий iOS выше 12.3.1 диплинки в трекинг-ссылках не работают. Если вы попытаетесь использовать такую ссылку, система не сможет перенаправить вас в уже установленное приложение. Чтобы перенаправить пользователя в iOS приложение, настройте переход в него по технологии Universal Link.

Система iOS требует защищенного соединения между приложением и связанными с ним доменами. Чтобы установить такое соединение, AppMetrica помещает файл `apple-app-site-association` на свой домен. Файл содержит Bundle ID и App Prefix приложения.


## Настройка Universal Link {#link-settings}

Чтобы активировать Universal Links для вашего приложения, в веб-интерфейсе AppMetrica выполните следующие действия:

1. Перейдите в раздел **Приложения**.
2. Выбрав приложение, перейдите в раздел **Настройки**.
3. Откройте вкладку **Основное** и введите Bundle ID и App Prefix приложения в соответствующие поля.

   {% cut "Как получить Bundle ID" %}

   Значение Bundle ID можно найти в [консоли разработчика Apple](https://developer.apple.com/), в разделе **Organization Profile** → **Account Summary**, а также в Xcode, в разделе **Target** → **General**.

   {% endcut %}

   {% cut "Как получить App Prefix" %}

   Значение App Prefix можно найти в [консоли разработчика Apple](https://developer.apple.com/). В большинстве случаев App Prefix [совпадает с Team ID](https://developer.apple.com/library/ios/technotes/tn2311/_index.html). Этот идентификатор доступен также в консоли разработчика Apple (в разделе **Member Center** нажмите на свое имя в правом верхнем углу окна и выберите **View Account** → **Developer Account Summary**).

   {% endcut %}

4. Установите переключатель Использовать **Universal Link** в положение **Вкл.** и нажмите **Сохранить настройки**. После этого в поле **Universal Link** появится ссылка вида `applinks:<app_id>.redirect.appmetrica.yandex.com`, где `<app_id>` — идентификатор вашего приложения в AppMetrica (**ID приложения**).

## Подготовка приложения {#app-prepare}

Если ваше приложение уже зарегистрировано в Центре Разработчиков Apple, в консоли разработчика необходимо включить **Associated Domains** для идентификатора приложения:

1. Перейдите в раздел **Identifiers** → **App IDs**.
2. Выбрав приложение, включите опцию **Associated Domains** для столбцов **Development** и **Distribution**.

## Настройка приложения {#ap-settings}

В интерфейсе Xcode выполните следующие действия:

1. Выберите **target** приложения.
2. В разделе **Capabilities** включите опцию **Associated Domains**.
3. В поле **Domains** введите Universal Link, сгенерированный AppMetrica.

## Использование прямой Universal Link {#types}

Прямая Universal Link имеет следующий формат:

```
https://<application_id>.redirect.appmetrica.yandex.com/?appmetrica_tracking_id=<tracking_id>
```
Ссылка такого формата будет автоматически генерироваться в настройках трекера после выполнения этой инструкции в поле App-to-app трекинг-ссылка.

В зависимости от обстоятельств, при переходе по такой ссылке происходит следующее:

* запуск приложения, если оно установлено;
* переход на страницу приложения в App Store, если оно не установлено.


{% note info %}

Если iOS приложение уже установлено, оно откроется напрямую, без перехода на наш сервис редиректов. Это означает, что клик не засчитается. В таких случаях считается только открытие приложения по ссылке.

Так же будет посчитан клик, если при переходе приложение не было установлено и пользователь перенаправился в App Store.

{% endnote %}


## Тестирование {#testing}

Теперь ваше приложение полностью настроено, и вы можете использовать Universal Links. Пока для приложения включены Universal Links, при обращении к домену вида `applinks:<app_id>.redirect.appmetrica.yandex.com`, будет совершен переход напрямую в приложение.

{% note info %}

Проверить работу Universal Link можно только на реальном устройстве. В случае изменения **Associated Domain**, убедитесь в том, что приложение было переустановлено.

{% endnote %}

Если вместо приложения открывается Safari, переустановите приложение. Если проблема не устранена, добавьте еще одну строку **Associated Domains** в Xcode (таким образом он поменяется) и переустановите приложение.

Убедитесь, что ваша ссылка имеет тот же домен, что и в приложении.

{{ feedback }}

<a href="../../../troubleshooting/feedback-new.html">
  <span class="button">Написать в службу поддержки</span>
</a>

{% include notitle [feedback](../../../_includes/feedback-button.md) %}
